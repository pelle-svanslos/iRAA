document.addEventListener("touchmove",function(e){e.preventDefault()},!1),document.addEventListener("touchhold",function(e){e.preventDefault()},!1);var SLticketContents=[["Reducerat pris","reducedprice"],["Zon A","zonea"],["Zon B","zoneb"],["Zon C","zonec"],["Länspassage","lanspassage"]],GBticketContents=[["Reducerat pris","reducedprice"],["Natt","gbgn"],["Göteborg","gbg"],["Göteborg +","gbgp"],["Göteborg ++","gbgpp"],["Göteborg +++","gbgppp"]],unknownCode=["4U","9Q","4B","7D","6M","3V","5V","1S","7Y"],textbase="0123456789",alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZ",plustext="AEOX",months=["jan","feb","mar","apr","maj","jun","jul","aug","sep","okt","nov","dec"],firstnameList=new Array("Christian","Anders","Martin","John","Jessica","Lucas","Carl","Filip","Daniel","Johan","Kim","Anna","Felicia","Fredrik","Magnus","Pär","David","Jonas","Simon","Angelica","Adnan","Isaac","Michael","Yvonne","Staffan","Lars","Harris","Erik","Tina","Peter","Julia","Cecilia","Jakob","William","Lennart","Joakim","Marcus","Gunilla","Camilla","Bettan","Olga","Louis","Alma","Mary","Fredrika","Josefin","Matilda","Eva","Marie","Karl","Jan","Uno","Hans","Heidar","Sven","Gunnar","Rimon","Houman","Nils","Per"),lastnameList=new Array("Granlund","Lundberg","Andersson","Holmberg","","Grufman","","Kalderén","Holm","Carlsson","","Jobb","Tele2","Frost","Hansson","Knutsson","Blomberg","Almlöf","Dahl","Höglund","Asplund","Edman","Ingdahl","Hällström","Ek","Bäckström","Ekblad","Eriksson","Kvick","","Bonnier","","Telia","","","Lidén","Norrman","","","Rydén","Lantz","","","","","","","Klasson","Lindblad","Molin","","Englund","Ottosson","Rosén","Ekman","Boström","Hallberg","Borg","Palm","Jönsson"),messagesList=new Array("Kommer ni i helgen?","Kan du åka förbi Jonas efter jobbet?","Blir du sen ikväll med?","Lunch idag?","Kan du tanka mitt kontantkort?","SVARA!!!","Ringer dig efter mötet.","Mötet flyttat till 14.00!","Suveränt!","Tackar!","Okej.","Bilen är nu klar att hämta.","Har din sambo sagt något?","Kan inte hitta bilnycklarna... ","Vad blir det för mat ikväll?","Vi får handla något för imorgon.","Kanon! Tack","Någon annan kväll får det bli.","Kan tyvärr inte.","Japp!","Klockan fyra blir perfekt!","Krya på dig!","Härligt.","Jag lär bli sen","Bussen går om 5 min","Vi möts på Wayne's Coffe kl 2","Helt fel","Ja, det ska jag.","Ring","Har du kontokortet på dig?","Du glömde ditt busskort!","Sms:a 072-305 03 92.","Viktigt! svara","Lika bra att fråga","Skynda dig","Gör så","Har du Agnetas nummer?","Blir sen till mötet.","Jaja","Allt är bara bra, sj?","Vi ses i Kista Galleria.","Måste förbi The Phone House först.","Ska möta henne senare ikväll, varför?","Haha","Det blir bra som det är asså","Ska du ha något från Ica?","Jag är på tåget","Hurså?","Vi ses där","Jaja, det är bara att ringa","Jorå, det går bra hälsa från Martin.","Nej","Aldrig!!","Ska hämta upp ungarna.","Åker förbi Hemköp!så att du vet :)","Gissa vem jag såg! Såg din chef i centralen, vad han har blivit stor ha!","Ska klippa mig.","Ring mig, det är viktig.","Möter du oss eller?","Någonstans mellan 21 och 23 tror jag.","Vadåra?","Har han sagt något?","Kan du ge han mitt nummer?tack","Överför 1000kr till mitt konto.","Resan kostar 5000 inkl hotell","Ska vi ut ikväll?","Vi ses.","Ok","Nää","Varför?","Jag kan inte,vi får ta det imorgon helt enkelt!","Slutar om en kvart","Ja","Hur?","När?","Var?","Kan du?","Glömde körkortet, haha.","Får lön den 25:e","Har tagit ut min semester nu, fyfan!","Sköt om dig"),weekDays=["söndag","måndag","tisdag","onsdag","torsdag","fredag","lördag"],redprices=[20,30,40],fullprices=[36,54,72],redpricesL=[20,40,50,60],fullpricesL=[36,72,90,108],ticketScroll,keyboardVisible=!1,dragged=!1,contactbtnVisible=!1,copyVisible=!1,currPage="ticket",currentViewportPage="settings",updateButtonActive=!1,chooseTicketVisible=!1,aboutScroll,ticketType;$(function(){null===localStorage.getItem("ticketType")?(setTicketType("SL"),$("#settingsHeader").text("Ny SL Biljett")):(setTicketType(localStorage.getItem("ticketType")),$("#settingsHeader").text("Ny "+ticketType+" Biljett"))});var setTicketType=function(e){var t=$("#newticketform");if(t.html(""),"SL"==e){for(var a=0;a<SLticketContents.length;a++)t.append('<div class="listitem"><span>'+SLticketContents[a][0]+'</span><div><input id="'+SLticketContents[a][1]+'" type="checkbox"/></div></div>'),0==a&&t.append("<hr>");ticketType="SL"}else if("VT"==e){t.append('<div class="listitem"><span>'+GBticketContents[0][0]+'</span><div><input id="'+GBticketContents[0][1]+'" type="checkbox"/></div></div>'),t.append('<div class="listitem"><span>'+GBticketContents[1][0]+'</span><div><input id="'+GBticketContents[1][1]+'" type="checkbox"/></div></div><hr>');for(var a=2;a<GBticketContents.length;a++)t.append('<div class="listitem"><span>'+GBticketContents[a][0]+'</span><div><input id="'+GBticketContents[a][1]+'" name="gbgtype" type="radio" class="gbgradio"/></div></div>');ticketType="VT"}else t.html("Invalid ticket type: "+e),ticketType="#";localStorage.setItem("ticketType",ticketType),$("input").on("tap",function(e){$(this).prop("checked",!this.checked)})},addcalclick=function(){$("#popup_bg").fadeIn("fast"),$("#addtocalendar").animate({bottom:"0px"},200)},getRandomChar=function(e){return e[Math.floor(Math.random()*e.length)]},populateInbox=function(e){for(var t=[0,0,0,0,0,0,0,0,0],a=(new Date,1);9>a;a++)rand=Math.ceil(6*Math.random()),t[a]=rand;t.sort();for(var a=1;10>a;a++){var o=Math.floor(Math.random()*firstnameList.length),r=Math.floor(Math.random()*lastnameList.length);$("#inbox_fake_sms_"+a+"_t1").html(firstnameList[o]+" "+lastnameList[r]);var n=Math.floor(Math.random()*messagesList.length);if(messagesList[n].length<45)var l="<br />&nbsp;";else l="";$("#inbox_fake_sms_"+a+"_t2").html(messagesList[n]+l);var s=new Date;if(s.setDate(e.getDate()-t[a-1]),0==t[a-1])if(e.getHours()<2)$("#inboxgotit_"+a).html("igår");else{var i,c=Math.floor(Math.random()*(e.getHours()-(e.getHours()-2)+1)+(e.getHours()-2));i=c==e.getHours()?e.getMinutes():59;var g=Math.floor(Math.random()*(i-0+1)+0);c=10>c?"0"+c:c,g=10>g?"0"+g:g,$("#inboxgotit_"+a).html(c+":"+g)}else 1==t[a-1]?$("#inboxgotit_"+a).html("igår"):$("#inboxgotit_"+a).html(weekDays[s.getDay()])}};$(function(){function e(){var e=[25,49,60,93],t=[19,37,45,70],o=[50,74,85,118],r=[44,62,70,95],n=$("input[name=gbgtype]:checked").prop("id");if(null==n)return alert("Du måste välja ett av alternativen!"),!1;for(var l="",s=null==localStorage.getItem("telenr")?"789":localStorage.getItem("telenr");3!=l.length||isNaN(l);){if(l=prompt("Ange de tre sista siffrorna i ditt telefonnummer: ",s),null==l)return!1;(3!=l.length||isNaN(l))&&alert("Felaktig input!")}localStorage.setItem("telenr",l);var i;$("#gbg").prop("checked")&&(i="G"),$("#gbgp").prop("checked")&&(i="GP"),$("#gbgpp").prop("checked")&&(i="GPP"),$("#gbgppp").prop("checked")&&(i="GPPP"),$("#gbgk").prop("checked")&&(i="KU");var c;if($("#reducedprice").prop("checked")){i+="S",c=getRandomChar("s");for(var g=" ",m=0;m<i.length-2;m++)g+="+";g+=" ",g=-1==g.indexOf("+")?" ":g;var d;d=g.length>1?g+"inom Göteborgs kommun"+g:g+"inom området Göteborg"+g,localStorage.setItem("zoneText1","SKOLUNGDOM GÖTEBORG"+d),$("#gbgn").prop("checked")?(localStorage.setItem("priceText1",r[i.length-2]),i+="N"):localStorage.setItem("priceText1",t[i.length-2]),localStorage.setItem("zoneText2",i)}else{i+="V",c=getRandomChar("veu");for(var g=" ",m=0;m<i.length-2;m++)g+="+";g+=" ",g=-1==g.indexOf("+")?" ":g;for(var g=" ",m=0;m<i.length-2;m++)g+="+";g+=" ",g=-1==g.indexOf("+")?" ":g;var d;d=g.length>1?g+"inom Göteborgs kommun"+g:g+"inom området Göteborg"+g,localStorage.setItem("zoneText1","VUXEN GÖTEBORG"+d),$("#gbgn").prop("checked")?(localStorage.setItem("priceText1",o[i.length-2]),i+="N"):localStorage.setItem("priceText1",e[i.length-2]),localStorage.setItem("zoneText2",i)}-1!=i.indexOf("P")?validTime=10800:validTime=5400;var u=Math.round((new Date).getTime()/1e3),b=new Date(1e3*u),h=u+validTime,p=new Date(1e3*h),f=b.getDate();10>f&&(f=""+f);var k=b.getFullYear();10>k&&(k="0"+k);var v=b.getMonth()+1;10>v&&(v="0"+v);var S=months[b.getMonth()],I=textbase.charAt(b.getMonth()),x=b.getHours();10>x&&(x="0"+x);var _=b.getMinutes();10>_&&(_="0"+_);var T=p.getDate();10>T&&(T="0"+T);var M=p.getFullYear();10>M&&(M="0"+M);var w=p.getMonth()+1;10>w&&(w="0"+w);var y=(months[p.getMonth()],p.getHours());10>y&&(y="0"+y);var V=p.getMinutes();10>V&&(V="0"+V);for(var H="",m=0;4>m;m++){Math.floor(Math.random()*textbase.length);H+=textbase.charAt(Math.floor(Math.random()*textbase.length))}var D=parseInt(_)+Math.floor(6*Math.random())+1;D=9>D?"0"+D:D,H+=""+D;var A="+-/*",z=A[Math.floor(Math.random()*A.length)],C=alphabet[b.getMonth()];c=null!=i.match("PPP")?getRandomChar("uU")+getRandomChar("sS")+c:null!=i.match("PP")?getRandomChar("uU")+getRandomChar("sS")+c:null!=i.match("P")?getRandomChar("gG")+getRandomChar("sS")+c:getRandomChar("gG")+getRandomChar("tT")+c;var L=unknownCode[b.getMinutes()%unknownCode.length],O=h.toString();O=O.substring(O.length-6,O.length);var B=x+""+_+C+f+c+l+L+O;localStorage.setItem("code",B),localStorage.setItem("sender_number",H),localStorage.setItem("magic_number",D),localStorage.setItem("msg_symbol",z),localStorage.setItem("validuntil",h),localStorage.setItem("order_Date",f),localStorage.setItem("order_Year",k),localStorage.setItem("order_Month",v),localStorage.setItem("order_Month2",I),localStorage.setItem("order_Month_text",S),localStorage.setItem("order_Hour",x),localStorage.setItem("order_Minute",_),localStorage.setItem("until_Date",T),localStorage.setItem("until_Year",M),localStorage.setItem("until_Month",w),localStorage.setItem("until_Minute",V),localStorage.setItem("until_Hour",y),localStorage.setItem("until_Minute",V),a(!0)}function t(){if(!($("#zonea").prop("checked")||$("#zoneb").prop("checked")||$("#zonec").prop("checked")||$("#lanspassage").prop("checked")))return alert("Minst en zon måste vara vald!"),!1;if($("#lanspassage").prop("checked")){if($("#zonea").prop("checked")&&!$("#zoneb").prop("checked")&&!$("#zonec").prop("checked"))return alert("Ogiltig kombination med länspassage!"),!1;if(!$("#zonea").prop("checked")&&$("#zoneb").prop("checked")&&!$("#zonec").prop("checked"))return alert("Ogiltig kombination med länspassage!"),!1;if($("#zonea").prop("checked")&&$("#zoneb").prop("checked")&&!$("#zonec").prop("checked"))return alert("Ogiltig kombination med länspassage!"),!1;if($("#zonea").prop("checked")&&!$("#zoneb").prop("checked")&&$("#zonec").prop("checked"))return alert("Ogiltig kombination med länspassage!"),!1}var e=Math.round((new Date).getTime()/1e3),t=new Date(1e3*e),o="";$("#zonea").prop("checked")&&(o+="A"),$("#zoneb").prop("checked")&&(o+="B"),$("#zonec").prop("checked")&&(o+="C");var r=!1;$("#lanspassage").prop("checked")&&(r=!0),$("#reducedprice").prop("checked")?(localStorage.setItem("zoneText1","R"),localStorage.setItem("priceText1","Red pris"),r?(localStorage.setItem("zoneText2",o+"L"),localStorage.setItem("priceText2",redpricesL[o.length])):(localStorage.setItem("zoneText2",o),localStorage.setItem("priceText2",redprices[o.length-1]))):(localStorage.setItem("zoneText1","H"),localStorage.setItem("priceText1","Helt pris"),r?(localStorage.setItem("zoneText2",o+"L"),localStorage.setItem("priceText2",fullpricesL[o.length])):(localStorage.setItem("zoneText2",o),localStorage.setItem("priceText2",fullprices[o.length-1]))),"ABC"==o||""==o&&r?validTime=7200:validTime=4500;var n,l=e+validTime,s=new Date(1e3*l),i=Math.floor(10*Math.random()),c=Math.floor(10*Math.random()),g=Math.floor(10*Math.random()),m=Math.floor(10*Math.random()),d=Math.floor(10*Math.random()),u=Math.floor(10*Math.random()),b=Math.floor(10*Math.random());if(Math.random()<.7){var h=Math.floor(10*Math.random());n=Math.floor(10*Math.random())+""+h}else n=Math.floor(10*Math.random());var p,f=m+""+d+u+b+n+i+c+g;p=8==f.length?1:0;for(var k="",v=0;6>v;v++){var S=Math.floor(Math.random()*textbase.length);k+=textbase.charAt(Math.floor(Math.random()*textbase.length))}for(var I="E",v=0;9>v;v++){var S=Math.floor(Math.random()*plustext.length);I+=plustext.substring(S,S+1)}for(var x="E",v=0;9>v;v++){var S=Math.floor(Math.random()*plustext.length);x+=plustext.substring(S,S+1)}for(var _="E",v=0;9>v;v++){var S=Math.floor(Math.random()*plustext.length);_+=plustext.substring(S,S+1)}var T=t.getDate();10>T&&(T=""+T);var M=t.getFullYear();10>M&&(M="0"+M);var w=t.getMonth()+1;10>w&&(w="0"+w);var y=months[t.getMonth()],V=textbase.charAt(t.getMonth()),H=t.getHours();10>H&&(H="0"+H);var D=t.getMinutes();10>D&&(D="0"+D);var A=s.getDate();10>A&&(A="0"+A);var z=s.getFullYear();10>z&&(z="0"+z);var C=s.getMonth()+1;10>C&&(C="0"+C);var L=(months[s.getMonth()],s.getHours());10>L&&(L="0"+L);var O=s.getMinutes();10>O&&(O="0"+O),localStorage.setItem("validuntil",l),localStorage.setItem("r1",i),localStorage.setItem("r2",c),localStorage.setItem("r3",g),localStorage.setItem("underline_link",p),localStorage.setItem("randomstring2nd",f),localStorage.setItem("randomstring",k),localStorage.setItem("aeoxrandom1",I),localStorage.setItem("aeoxrandom2",x),localStorage.setItem("aeoxrandom3",_),localStorage.setItem("order_Date",T),localStorage.setItem("order_Year",M),localStorage.setItem("order_Month",w),localStorage.setItem("order_Month2",V),localStorage.setItem("order_Month_text",y),localStorage.setItem("order_Hour",H),localStorage.setItem("order_Minute",D),localStorage.setItem("until_Date",A),localStorage.setItem("until_Year",z),localStorage.setItem("until_Month",C),localStorage.setItem("until_Minute",O),localStorage.setItem("until_Hour",L),localStorage.setItem("until_Minute",O),a(!0)}function a(e){"SL"==ticketType?o(e):"VT"==ticketType&&r(e)}function o(e){var t=new Date,a=new Array(7);a[0]="sön",a[1]="mån",a[2]="tis",a[3]="ons",a[4]="tor",a[5]="fre",a[6]="lör";var o=a[t.getDay()],r=0,l=t.getDate(),s="";if(localStorage.getItem("order_Date")==l){var o="idag";r=1}else if(localStorage.getItem("order_Date")==l-1){var o="igår";r=1}else if(localStorage.getItem("order_Date")==l-2){var o="i förrgår";r=1}if(0==r&&(s=localStorage.getItem("order_Date")+" "+localStorage.getItem("order_Month_text")),$("#msgtimetext").html("Meddelande</br>"+o+" "+s+' <span class="thin">'+localStorage.getItem("order_Hour")+":"+localStorage.getItem("order_Minute")+"</span>"),$("#msgtimetext").append('<div class="doubletap-window" id="inbox-message"></div>'),$("#messageview").before('<div class="btn_contacts" id="btn_contacts">SL'+localStorage.getItem("r1")+localStorage.getItem("r2")+localStorage.getItem("r3")+"</div>"),n("ticket"),$("#b2message").html("SL"+localStorage.getItem("r1")+localStorage.getItem("r2")+localStorage.getItem("r3")),$("#ticketfromphonenr").html("SL"+localStorage.getItem("r1")+localStorage.getItem("r2")+localStorage.getItem("r3")),$("#ticketundertext").html(localStorage.getItem("zoneText1")+"-"+localStorage.getItem("zoneText2")+" "+localStorage.getItem("until_Hour")+":"+localStorage.getItem("until_Minute")+" "+localStorage.getItem("r1")+localStorage.getItem("r2")+localStorage.getItem("r3")+'...<br /><span class="whitetext">&nbsp;</span>'),$("#ticketgotit").html(localStorage.getItem("order_Hour")+":"+localStorage.getItem("order_Minute")),$("#senttophonenr").html("076-720 10 10"),$("#ticketundertext2").html(localStorage.getItem("zoneText1")+""+localStorage.getItem("zoneText2")+"<br />&nbsp;"),$("#ticketgotit2").html(localStorage.getItem("order_Hour")+":"+localStorage.getItem("order_Minute")),populateInbox(t),e){var i=300,c="#inboxpage";currentViewportPage="inbox",d.scrollTo(0,-90,0)}else{var i=0,c="#messagepage";currentViewportPage="message"}$("#viewport").scrollTo2(c,i)}function r(e){var t=new Date,a=new Array(7);a[0]="sön",a[1]="mån",a[2]="tis",a[3]="ons",a[4]="tor",a[5]="fre",a[6]="lör";var o=a[t.getDay()],r=0,l=t.getDate(),s="";if(localStorage.getItem("order_Date")==l){var o="idag";r=1}else if(localStorage.getItem("order_Date")==l-1){var o="igår";r=1}else if(localStorage.getItem("order_Date")==l-2){var o="i förrgår";r=1}if(0==r&&(s=localStorage.getItem("order_Date")+" "+localStorage.getItem("order_Month_text")),$("#msgtimetext").html("Meddelande</br>"+o+" "+s+' <span class="thin">'+localStorage.getItem("order_Hour")+":"+localStorage.getItem("order_Minute")+"</span>"),$("#msgtimetext").append('<div class="doubletap-window" id="inbox-message"></div>'),$("#messageview").before('<div class="btn_contacts" id="btn_contacts">VT'+localStorage.getItem("sender_number")+"</div>"),n("ticket"),$("#b2message").html("VT"+localStorage.getItem("sender_number")),$("#ticketfromphonenr").html("VT"+localStorage.getItem("sender_number")),$("#ticketundertext").html(localStorage.getItem("magic_number")+localStorage.getItem("msg_symbol")+" --VÄSTTRAFIK-- giltig till "+localStorage.getItem("until_Hour")+":"+localStorage.getItem("until_Minute")+" "+localStorage.getItem("until_Year")+"-"+localStorage.getItem("until_Month")+"-"+localStorage.getItem("until_Date")+'...<br /><span class="whitetext">&nbsp;</span>'),$("#ticketgotit").html(localStorage.getItem("order_Hour")+":"+localStorage.getItem("order_Minute")),$("#senttophonenr").html("070-726 27 28"),$("#ticketundertext2").html(localStorage.getItem("zoneText2")+"<br />&nbsp;"),$("#ticketgotit2").html(localStorage.getItem("order_Hour")+":"+localStorage.getItem("order_Minute")),populateInbox(t),e){var i=300,c="#inboxpage";currentViewportPage="inbox",d.scrollTo(0,-90,0)}else{var i=0,c="#messagepage";currentViewportPage="message"}$("#viewport").scrollTo2(c,i)}function n(e){"SL"==ticketType?l(e):"VT"==ticketType&&s(e)}function l(e){if("ticket"==e){$("#b2messages").removeClass("back"),$("#b2messages").css("background-image","url(img/btn_messages.png)"),$("#slphone").html("SL"+localStorage.getItem("r1")+localStorage.getItem("r2")+localStorage.getItem("r3")),$("#btn_contacts").html("SL"+localStorage.getItem("r1")+localStorage.getItem("r2")+localStorage.getItem("r3")),$("#msgbubbleandlink").html('<div id="msgbubble" class="msgbubble"></div>');var t=$("#msgbubble");t.html(localStorage.getItem("zoneText1")+"-"+localStorage.getItem("zoneText2")+' <a href="javascript:addcalclick();">'+localStorage.getItem("until_Hour")+":"+localStorage.getItem("until_Minute")+"</a> "+localStorage.getItem("r1")+localStorage.getItem("r2")+localStorage.getItem("r3")+"<br /><br />"),t.append(localStorage.getItem("aeoxrandom1")+"<br />"),t.append(localStorage.getItem("aeoxrandom2")+"<br />"),t.append(localStorage.getItem("aeoxrandom3")+"<br />"),t.append("EEEEEEEEEE<br /><br />"),t.append('SL biljett giltig <a href="javascript:addcalclick();">till '+localStorage.getItem("until_Hour")+":"+localStorage.getItem("until_Minute")+"<br />"+localStorage.getItem("until_Year")+"-"+localStorage.getItem("until_Month")+"-"+localStorage.getItem("until_Date")+"</a><br />"),t.append(localStorage.getItem("priceText1")+" "+localStorage.getItem("priceText2")+" kr ink 6%<br />moms<br />"),1==localStorage.getItem("underline_link")?t.append('<a href="tel:'+localStorage.getItem("randomstring")+" "+localStorage.getItem("randomstring2nd")+'">'+localStorage.getItem("randomstring")+" "+localStorage.getItem("randomstring2nd")+"</a><br />"):t.append('<a href="tel:'+localStorage.getItem("randomstring")+'">'+localStorage.getItem("randomstring")+" "+localStorage.getItem("randomstring2nd").slice(0,-1)+"</a><br />"),$("#msgbubble").css({"font-size":"34px"}),t.append('<a href="http://mobil.sl.se">sl.se</a>'),t.bind("doubletap",function(e){event.preventDefault(),$("#inbox-message").fadeIn("fast"),t.addClass("selected"),copyVisible=!0,$("#inbox-message").click(function(e){$("#inbox-message").fadeOut("fast"),t.removeClass("selected"),copyVisible=!1})})}else"sent"==e&&($("#b2messages").addClass("back"),$("#b2messages").css("background-image","url(img/btn_back.png)"),$("#slphone").html("076-720 10 10"),$("#btn_contacts").html("076-720 10 10"),1==localStorage.getItem("zoneText2").length?$("#msgbubbleandlink").html('<div class="msgbubble_small">'+localStorage.getItem("zoneText1")+localStorage.getItem("zoneText2")+"</div>"):2==localStorage.getItem("zoneText2").length?$("#msgbubbleandlink").html('<div class="msgbubble_medium">'+localStorage.getItem("zoneText1")+localStorage.getItem("zoneText2")+"</div>"):3==localStorage.getItem("zoneText2").length?$("#msgbubbleandlink").html('<div class="msgbubble_large">'+localStorage.getItem("zoneText1")+localStorage.getItem("zoneText2")+"</div>"):$("#msgbubbleandlink").html('<div class="msgbubble_xtralarge">'+localStorage.getItem("zoneText1")+localStorage.getItem("zoneText2")+"</div>"))}function s(e){if("ticket"==e){$("#b2messages").removeClass("back"),$("#b2messages").css("background-image","url(img/btn_messages.png)"),$("#slphone").html("VT"+localStorage.getItem("sender_number")),$("#btn_contacts").html("VT"+localStorage.getItem("sender_number")),$("#msgbubbleandlink").html('<div id="msgbubble" class="msgbubble"></div>');var t=$("#msgbubble");t.html(localStorage.getItem("magic_number")+localStorage.getItem("msg_symbol")+' --VÄSTTRAFIK-- giltig till <a href="javascript:addcalclick();">'+localStorage.getItem("until_Hour")+":"+localStorage.getItem("until_Minute")+"<br />"+localStorage.getItem("until_Year")+"-"+localStorage.getItem("until_Month")+"-"+localStorage.getItem("until_Date")+"</a><br />"),t.append(localStorage.getItem("zoneText1")+"<br />");var a=localStorage.getItem("code");t.append('<span style="font-size: 33px">'+localStorage.getItem("priceText1")+',00kr (inkl.6% moms)</span> <span style="font-size: 34px">'+a.substring(0,a.length-2)+"<br />"+a.substring(a.length-2,a.length)+"</span>"),$("#msgbubble").css({"font-size":"32px"}),t.bind("doubletap",function(e){event.preventDefault(),$("#inbox-message").fadeIn("fast"),t.addClass("selected"),copyVisible=!0,$("#inbox-message").click(function(e){$("#inbox-message").fadeOut("fast"),t.removeClass("selected"),copyVisible=!1})}),$("#slphone").animate({left:"30px"})}else if("sent"==e){$("#b2messages").addClass("back"),$("#b2messages").css("background-image","url(img/btn_back.png)"),$("#slphone").html("070-726 27 28"),$("#btn_contacts").html("070-726 27 28");var o=localStorage.getItem("zoneText2");2==o.length?$("#msgbubbleandlink").html('<div class="msgbubble_small">'+o+"</div>"):3==o.length?$("#msgbubbleandlink").html('<div class="msgbubble_medium">'+o+"</div>"):4==o.length?$("#msgbubbleandlink").html('<div class="msgbubble_large">'+o+"</div>"):5==o.length?$("#msgbubbleandlink").html('<div class="msgbubble_xtralarge">'+o+"</div>"):$("#msgbubbleandlink").html('<div class="msgbubble_xtraxtralarge">'+o+"</div>")}}var i=function(e){if(deviceWidth=$("#viewport").width(),deviceHeight=$("#viewport").height(),640==deviceWidth?currentOrientation="portrait":currentOrientation="landscape",deviceHeight<1e3?device="ip4":device="ip5",m.minScrollY=0,"ticket"==currPage)if(keyboardVisible){if(keyboardVisible){$("#textinputmessage").animate({bottom:$("#textinputmessage").height()-88+"px"},e);var t=$("#msgbubble").outerHeight()+$("#msgtimetext").outerHeight(),a=$("#messagepage").height()-($(".navbartop").outerHeight()+$("#textinputmessage").height()),o=-(t-.85*a);if(o=o>=0?0:o,"portrait"==currentOrientation&&"ip4"==device)m.maxScrollY=o,m.startY=o,m.scrollTo(0,o,4*e);else if("portrait"==currentOrientation&&"ip5"==device)m.maxScrollY=o,m.startY=o,m.scrollTo(0,o,4*e);else if("landscape"==currentOrientation){var o=-(t-.5*a);m.maxScrollY=o,m.startY=o,m.scrollTo(0,o,4*e)}}}else{$("#textinputmessage").animate({bottom:"0px"},e);var t=$("#msgbubble").outerHeight()+$("#msgtimetext").outerHeight(),a=$("#messagepage").height()-($(".navbartop").outerHeight()+88),o=-(t-.85*a);o=o>=0?0:o,"portrait"==currentOrientation?(m.maxScrollY=0,m.startY=0,m.scrollTo(0,0,4*e)):"landscape"==currentOrientation&&(m.maxScrollY=o,m.startY=o,m.scrollTo(0,o,4*e))}else"sent"==currPage&&(keyboardVisible?keyboardVisible&&($("#textinputmessage").animate({bottom:$("#textinputmessage").height()-88+"px"},e),"portrait"==currentOrientation||"landscape"==currentOrientation&&(m.maxScrollY=-80,m.startY=-80,m.scrollTo(0,-80,4*e))):($("#textinputmessage").animate({bottom:"0px"},e),"portrait"==currentOrientation||"landscape"==currentOrientation&&(m.maxScrollY=0,m.startY=0,m.scrollTo(0,0,4*e))))},c=function(e){"settings"==currentViewportPage?$("#viewport").scrollTo2("#settings",0):"inbox"==currentViewportPage?$("#viewport").scrollTo2("#inboxpage",0):"message"==currentViewportPage?$("#viewport").scrollTo2("#messagepage",0):"about"==currentViewportPage?$("#viewport").scrollTo2("#about",0):console.log("An orientation-error occured!"),setTimeout(function(){i(0),k(),aboutScroll.maxScrollY=-($("#changes").height()-$("#aboutview").height()+$("#contact").height()+$("#status").height())},150)};$(window).bind("orientationchange",c),$(window).bind("resize",c);var g=Math.round((new Date).getTime()/1e3);parseInt(localStorage.getItem("validuntil"))>g?a(!1):$("#viewport").scrollTo2("#settings",0);var m=new IScroll("#messageview",{click:!0,tap:!0}),d=new IScroll("#inboxcontent",{click:!0,tap:!0});d.scrollTo(0,-90,0),i(0),$("#textinputmessage").click(function(e){keyboardVisible||(keyboardVisible=!0,i(200))}),$("#popup_bg").click(function(){$("#popup_bg").fadeOut("fast"),$("#addtocalendar").animate({bottom:"-400px"},200)}),$("#addtocalendar").click(function(){$("#popup_bg").fadeOut("fast"),$("#addtocalendar").animate({bottom:"-400px"},200)});$("#b2messages, #b2message, #b1newmsg, #b2newmsg, #b_about_left").on("touchstart",this,function(e){$(this).css("background-position","0 60px"),e.preventDefault()}).on("touchend",this,function(e){"b2messages"==e.target.id?($(this).css("background-position","0 0px"),$("#slphone").animate({left:"3px"}),$("#viewport").scrollTo2("#inboxpage",300),h(),keyboardVisible=!1,i(200),d.scrollTo(0,-90,0),currentViewportPage="inbox"):"b1newmsg"==e.target.id?($(this).css("background-position","0 0px"),$("#viewport").scrollTo2("#settings",300),currentViewportPage="settings"):"b2message"==e.target.id?($(this).css("background-position","0 0px"),h(),keyboardVisible=!1,$("#viewport").scrollTo2("#messagepage",300),currentViewportPage="message"):"b2newmsg"==e.target.id?($(this).css("background-position","0 0px"),h(),$("#viewport").scrollTo2("#settings",300),currentViewportPage="settings"):"b_about_left"==e.target.id&&updateButtonActive&&window.applicationCache.update()}),$("#btn_edit1").on("touchstart",this,function(e){$("#btn_edit1").css({color:"rgba(89, 162, 252, 0.7)"})}).on("touchend",this,function(e){$("#btn_edit1").css({color:"rgb( 0, 122, 255 )"}),h(),$("#viewport").scrollTo2("#settings",300),currentViewportPage="settings"}),$("#btn_edit2").on("touchstart",this,function(e){$("#btn_edit2").css({color:"rgba(89, 162, 252, 0.7)"})}).on("touchend",this,function(e){$("#btn_edit2").css({color:"rgb( 0, 122, 255 )"});var t=$("#btn_edit2"),a=200;"Detaljer"==t.text()?(t.fadeOut(a).hide().text("Klar").fadeIn(a),$("#btn_contacts").fadeIn("fast").animate({top:"128px"},300),$("#slphone").fadeOut(2*a),contactbtnVisible=!0):(t.fadeOut(a).hide().text("Detaljer").fadeIn(a),$("#btn_contacts").delay(100).animate({top:"0px"},400).fadeOut("fast"),$("#slphone").fadeIn(2*a),contactbtnVisible=!1)});var u=window.applicationCache;u.onchecking=function(e){$("#statusmessage").html("Letar efter uppdateringar..."),$("#statusmessage").css({color:"black"}),$("#btn_home_about").html("i"),$("#btn_home_about").css({"border-color":"rgb( 13, 122, 255 )",color:"rgb( 13, 122, 255)"}),updateButtonActive=!1,$("#b_about_left").css("background-position","0 60px")},u.ondownloading=function(e){$("#statusmessage").html("Laddar ner..."),$("#statusmessage").css({color:"blue"}),$("#btn_home_about").html("!"),$("#btn_home_about").css({"border-color":"rgb( 13, 122, 255 )",color:"rgb( 13, 122, 255)"}),updateButtonActive=!1,$("#b_about_left").css("background-position","0 60px")},u.onnoupdate=function(e){$("#statusmessage").html("IRAA är online & uppdaterad"),$("#statusmessage").css({color:"green"}),$("#btn_home_about").html("i"),$("#btn_home_about").css({"border-color":"rgb( 13, 122, 255 )",color:"green"}),updateButtonActive=!0,$("#b_about_left").css("background-position","0 0px")},u.onprogress=function(e){message="Laddar ner... ",e.lengthComputable?$("#statusmessage").html(message+e.loaded+" av "+e.total+" filer"):$("#statusmessage").html(message),$("#btn_home_about").html("..."),$("#btn_home_about").css({"border-color":"rgb( 13, 122, 255 )",color:"rgb( 245, 15, 15)"}),updateButtonActive=!1,$("#b_about_left").css("background-position","0 60px")},u.oncached=function(e){$("#statusmessage").html("iRAA använder en cachad version av sidan"),$("#btn_home_about").html("i"),$("#btn_home_about").css({"border-color":"rgb( 13, 122, 255 )",color:"rgb( 13, 122, 255)"}),updateButtonActive=!0,$("#b_about_left").css("background-position","0 0px")},u.onupdateready=function(e){$("#statusmessage").html('En ny version finns tillgänglig! <a href="javascript:window.location.reload()">Klicka här för att installera!</a>'),$("#statusmessage").css({color:"orange"}),$("#btn_home_about").html("!"),$("#btn_home_about").css({"border-color":"orange",color:"orange"}),updateButtonActive=!1,$("#b_about_left").css("background-position","0 60px"),u.swapCache()},u.onobsolete=function(e){$("#statusmessage").html("Appcache är obsolete")};var b=0;u.onerror=function(e){b++,5>b?$("#statusmessage").html("iRAA är offline"):$("#statusmessage").html("iRAA är offline. Var vänlig starta om iRAA om du tror att det är fel."),$("#statusmessage").css({color:"red"}),$("#btn_home_about").html("i"),$("#btn_home_about").css({"border-color":"rgb( 245, 15, 15 )",color:"rgb( 245, 15, 15)"}),updateButtonActive=!0,$("#b_about_left").css("background-position","0 0px")},$("#status").html('<h1 id="status">Status</h1><p id="statusmessage">Okänd status...</p><hr>');var h=function(){$("#textinputmessage").animate({bottom:"0px"},0),contactbtnVisible&&($("#btn_edit2").fadeOut(200).hide().text("Detaljer").fadeIn(200),$("#btn_contacts").animate({top:"0px"},300).fadeOut("fast"),$("#slphone").fadeIn(400),contactbtnVisible=!1)},p=function(){$.ajax({url:"./manifest.appcache",type:"get",dataType:"text",success:function(e){var t=e.split("\n")[2].replace("#","");$("#latestVersion").html(t)}})},f=function(){$.ajax({url:"./CHANGES",type:"get",dataType:"text",success:function(e){var t=e.split("\n");$("#changes").append('<h1 id="changelog">Changelog</h1>');for(var a=0;a<t.length;a++)-1!=t[a].indexOf("# NYTT")?$("#changes").append("<h2>"+t[a]+"</h2>"):-1!=t[a].indexOf("---------")?$("#changes").append("<hr>"):$("#changes").append("<p>"+t[a]+"</p>")}})};$("#chooseTicketBody").append('<div id="SL" class="town">Stockholm</div>').append('<div id="VT" class="town">Västtrafik</div>'),$(".town").on("touchstart",this,function(e){$(this).css({"background-color":"rgb(200,200,200)"})}).on("touchend",this,function(e){$(this).css({"background-color":"rgb(247,247,247)"}),chooseTicketVisible=!1,$("#chooseTicketBody").fadeOut(200),$("#settingsHeader").fadeOut(150).hide().text("Ny "+e.target.id+" Biljett").fadeIn(150),$("#chooseTicketButton").delay(150).fadeIn(150),$("#btn_home_done").fadeIn(150),setTicketType(e.target.id+""),k()});var k=function(e){ticketScroll.maxScrollY=-($("#newticketform").height()-($("#settings").height()-$(".navbartop").outerHeight()-$(".smallhelptext").outerHeight())),ticketScroll.maxScrollY=ticketScroll.maxScrollY>0?0:ticketScroll.maxScrollY-30};$("#chooseTicketButton").on("touchstart",this,function(e){$("#chooseTicketButton").css({color:"rgba(89, 162, 252, 0.7)"})}).on("touchend",this,function(e){$("#chooseTicketButton").css({color:"rgb( 0, 122, 255 )"}),chooseTicketVisible||(chooseTicketVisible=!0,$("#chooseTicketBody").fadeIn(200),$("#settingsHeader").fadeOut(150).delay(150).hide().text("Välj stad").fadeIn(150),$("#chooseTicketButton").hide(),$("#btn_home_done").fadeOut(150))}),$("#msgscrollablecontent").on("touchmove",this,function(e){contactbtnVisible&&($("#btn_edit2").fadeOut(200).hide().text("Detaljer").fadeIn(200),$("#btn_contacts").animate({top:"0px"},300).fadeOut("fast"),$("#slphone").fadeIn(400),
contactbtnVisible=!1),keyboardVisible&&(keyboardVisible=!1,i(200)),copyVisible&&($("#inbox-message").fadeOut("fast"),$("#msgbubble").removeClass("selected"),copyVisible=!1)}),$(".inboxitem").on("touchmove",this,function(e){dragged=!0,$(this).css("background","white"),$(this).find("div.inboxspace").css("background","white"),$(this).find("*").css("color","black"),$(this).find("div.inboxitemtext2").css("color","#808080"),$(this).find("div.inboxgotit").css("color","#808080"),$(this).find("img.listarrow").attr("src","img/listarrow.png")}).on("touchstart",this,function(e){dragged=!1;var t=$(this);setTimeout(function(){dragged||(t.css("background","-webkit-linear-gradient(top, rgb(215, 215, 215), rgb(215, 215, 215))"),t.find("div.inboxspace").css("background","-webkit-linear-gradient(top, rgb(215, 215, 215), rgb(215, 215, 215))"),t.find("div.inboxspace").css("margin-top","-5"))},50),e.preventDefault()}).on("touchend",this,function(e){var t=$(this);setTimeout(function(){t.css("background","white"),t.find("*").css("color","black"),t.find("div.inboxitemtext2").css("color","#808080"),t.find("div.inboxgotit").css("color","#808080"),t.find("img.listarrow").attr("src","img/listarrow.png"),t.find("div.inboxspace").css("background","white")},350),e.preventDefault()}),$("#btn_home_about").bind("tap",function(e){$("#viewport").scrollTo2("#about",300),aboutScroll.maxScrollY=-($("#changes").height()-$("#aboutview").height()+$("#contact").height()+$("#status").height()),aboutScroll.scrollToElement("#status"),currentViewportPage="about"}),$(".smallhelptext").bind("tap",function(e){$("#viewport").scrollTo2("#about",300),aboutScroll.maxScrollY=-($("#changes").height()-$("#aboutview").height()+$("#contact").height()+$("#status").height()),aboutScroll.scrollToElement("#changelog"),currentViewportPage="about"}),$("#ticketlink").click(function(e){return n("ticket"),$("#viewport").scrollTo2("#messagepage",300),currPage="ticket",currentViewportPage="message",keyboardVisible=!1,i(0),!1}),$("#sentticketlink").click(function(e){return n("sent"),$("#viewport").scrollTo2("#messagepage",300),currPage="sent",currentViewportPage="message",keyboardVisible=!1,i(0),!1}),$("#btn_home_done").on("touchstart",this,function(e){$("#btn_home_done").css({color:"rgba(89, 162, 252, 0.7)"})}).on("touchend",this,function(e){$("#btn_home_done").css({color:"rgb( 0, 122, 255 )"})}),$("#btn_home_done").click(function(a){"SL"==ticketType?t():"VT"==ticketType?e():alert("Okänd biljett-typ!")}),p(),f(),aboutScroll=new IScroll("#aboutview",{click:!0,tap:!0,preventDefaultExceptionkey:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT|P)$/}}),aboutScroll.maxScrollY=-($("#changes").height()-$("#aboutview").height()+$("#contact").height()+$("#status").height()),$("#contact").append("<h1>Kontakt</h1>"),$("#contact").append('<p>Underhåll: <a href="https://www.flashback.org/u499403">BillyMays @ Flashback</a></p><p>Donera: <br/>&nbsp;&nbsp;&nbsp;Bitcoin: <a href="https://blockchain.info/address/1NmRGFRmX8TACeD6ZcAxyAfhdYbPQf3Mo2">1NmRGFRmX8TACeD6ZcAxyAfhdYbPQf3Mo2</a></br >&nbsp;&nbsp;&nbsp;Barncancerfonden: <a href="http://www.barncancerfonden.se/stod-oss/Ge-en-gava/">Ge en gåva</a><br />&nbsp;&nbsp;&nbsp;Cancerfonden: <a href="http://www.cancerfonden.se/sv/Stod-oss/Ge-en-gava/">Ge en gåva</a></p><hr>'),ticketScroll=new IScroll("#ticketview",{click:!0,tap:!0}),k()});
